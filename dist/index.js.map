{"version":3,"file":"index.js","sources":["../src/hooks/useAuth.ts","../src/component/signInButton.tsx","../src/component/signoutButton.tsx","../src/component/userButton.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\n\r\nexport const useValidateUser = () => {\r\n  const [data, setData] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const res = await fetch(\r\n          \"http://localhost:3000/api/external/validate-user\",\r\n          {\r\n            method: \"GET\",\r\n            credentials: \"include\",\r\n          }\r\n        );\r\n\r\n        if (!res.ok) {\r\n          throw new Error(`Request failed: ${res.status}`);\r\n        }\r\n\r\n        const json = await res.json();\r\n        setData(json);\r\n      } catch (err: any) {\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  return { data, loading, error };\r\n};\r\n","import { useEffect } from \"react\";\r\nimport * as React from \"react\"; \r\ntype SignInButtonProps = {\r\n  provider: string; // \"google\", \"github\", etc.\r\n  websiteId: string;\r\n  redirectUrl?: string; // optional, default \"/\"\r\n  label?: string;\r\n};\r\n\r\n const SignInButton = ({\r\n  provider,\r\n  websiteId,\r\n  redirectUrl = \"/\",\r\n  label,\r\n}: SignInButtonProps) => {\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    const token = params.get(\"token\");\r\n\r\n    if (token) {\r\n      document.cookie = `authiq_token=${token}; path=/; Secure; SameSite=Lax`;\r\n\r\n      window.location.href = redirectUrl;\r\n    }\r\n  }, [redirectUrl]);\r\n\r\n  const handleSignIn = () => {\r\n    const callbackUrl = `${window.location.origin}${window.location.pathname}`; // same page\r\n    const authUrl = new URL(`http://localhost:3000/api/providers/${provider}`);\r\n    authUrl.searchParams.set(\"websiteId\", websiteId);\r\n    authUrl.searchParams.set(\"redirectUrl\", callbackUrl);\r\n    window.location.href = authUrl.toString();\r\n  };\r\n\r\n  return (\r\n    <button\r\n      onClick={handleSignIn}\r\n    >\r\n      {label || `Continue with ${provider.charAt(0).toUpperCase() + provider.slice(1)}`}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport {SignInButton}","import * as React from \"react\";\r\n\r\ntype SignOutButtonProps = {\r\n  redirectUrl?: string; \r\n  label?: string;\r\n};\r\n\r\nconst SignOutButton = ({\r\n  redirectUrl = \"/\",\r\n  label,\r\n}: SignOutButtonProps) => {\r\n  const handleSignOut = () => {\r\n    document.cookie =\r\n      \"authiq_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC; Secure; SameSite=Lax\";\r\n    window.location.href = redirectUrl;\r\n  };\r\n  return (\r\n    <button onClick={handleSignOut}>\r\n      {label || \"Sign out\"}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport { SignOutButton };\r\n","import * as React from \"react\";\r\nimport { SignOutButton } from \"./signoutButton\";\r\n\r\ntype User = {\r\n  name: string;\r\n  email: string;\r\n  image: string;\r\n};\r\n\r\nconst UserButton = () => {\r\n  const [user, setUser] = React.useState<User | null>(null);\r\n  const [open, setOpen] = React.useState(false);\r\n\r\nReact.useEffect(() => {\r\n  const fetchUser = async () => {\r\n    try {\r\n      const res = await fetch(\r\n        \"http://localhost:3000/api/external/validate-user\",\r\n        {\r\n          method: \"GET\",\r\n          credentials: \"include\",\r\n        }\r\n      );\r\n\r\n      if (!res.ok) return;\r\n\r\n      const data = await res.json();\r\n\r\n      if (data.authenticated && data.session) {\r\n        setUser(data.session);\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  };\r\n\r\n  fetchUser();\r\n}, []);\r\n\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <div style={{ position: \"relative\", display: \"inline-block\" }}>\r\n      {/* Avatar */}\r\n      <img\r\n        src={user.image}\r\n        alt={user.name}\r\n        onClick={() => setOpen(!open)}\r\n        style={{\r\n          width: 40,\r\n          height: 40,\r\n          borderRadius: \"50%\",\r\n          cursor: \"pointer\",\r\n          objectFit: \"cover\",\r\n        }}\r\n      />\r\n\r\n      {/* Popover */}\r\n      {open && (\r\n        <div\r\n          style={{\r\n            position: \"absolute\",\r\n            top: 52,\r\n            right: 0,\r\n            width: 220,\r\n            backgroundColor: \"#fff\",\r\n            borderRadius: 10,\r\n            padding: 12,\r\n            boxShadow: \"0 8px 20px rgba(0,0,0,0.15)\",\r\n            zIndex: 100,\r\n          }}\r\n        >\r\n          <img\r\n            src={user.image}\r\n            alt={user.name}\r\n            style={{\r\n              width: 60,\r\n              height: 60,\r\n              borderRadius: \"50%\",\r\n              display: \"block\",\r\n              margin: \"0 auto 8px\",\r\n              objectFit: \"cover\",\r\n            }}\r\n          />\r\n\r\n          <div style={{ textAlign: \"center\", marginBottom: 10 }}>\r\n            <div style={{ fontWeight: 600 }}>{user.name}</div>\r\n            <div style={{ fontSize: 13, color: \"#666\" }}>{user.email}</div>\r\n          </div>\r\n\r\n          <div\r\n            style={{\r\n              width: \"100%\",\r\n              padding: 8,\r\n              border: \"none\",\r\n              borderRadius: 6,\r\n              backgroundColor: \"#f44336\",\r\n              color: \"#fff\",\r\n              cursor: \"pointer\",\r\n              fontSize: 14,\r\n            }}\r\n          >\r\n            <SignOutButton />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport { UserButton };\r\n"],"names":[],"mappings":"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"}